<div class="row">
  <!--left hand side panel-->
  <div class="col-sm-4">
    <div class="row">
      <div class="col-sm-12">
        <div class="panel panel-card">
          <div class="card-heading">
            <h2>Order</h2>
          </div>
          <div class="p">
            Human readable ID  <span class="pull-right">{{vm.multi.human_readable_id}}</span>
          </div>
          <div class="list-group no-radius no-border">
            <a class="list-group-item" data-toggle="collapse" data-target="#buyer">
                <div ><span class="pull-right">{{vm.buyer.contact.firstname}} {{vm.buyer.contact.surname}}</span> Buyer</div>
            </a>
            <div id="buyer" class="collapse" style="padding: 0px 15px;">
                            <br>Created: <span class="pull-right ">{{vm.buyer.created_at_gmt| date}}</span><br>
                            email: <a ui-sref="users.profile({profileId: vm.buyer.id})" class="pull-right text-info">{{vm.buyer.contact.email}}</a><br><br>
            </div>
            <div class="list-group-item">
                <span class="pull-right ">{{vm.order.created| date: "d/M/yy"}}</span> Order date
            </div>
            <a data-toggle="collapse" data-target="#status" class="list-group-item">
              <span class="pull-right" ng-class="vm.changeColor(vm.order.status,'text')"><b>{{vm.order.status}}</b></span> Current status
              <div id="status" class="collapse">
                <br>
                <span ng-class="vm.changeColor(vm.order.status,'text')" ng-if="vm.order.status_changes[0].message"><p>{{vm.order.status_changes[0].message}}</p></span>
                  Printer Status <span class="pull-right" ng-class="{'text-success':vm.order.printer.status_text,'text-danger':vm.order.printer.error_text,'text-warning':!vm.order.printer}">
                    {{vm.order.printer.status_text?vm.order.printer.status_text:''}}
                    {{vm.order.printer.error_text?vm.order.printer.error_text:''}}
                    {{!vm.order.printer?'waiting':''}}
                  </span><br>
                  <span ng-if="vm.order.printer">Code <span class="pull-right" ng-class="{'text-success':vm.order.printer.status_text,'text-danger':vm.order.printer.error_text}">
                      {{vm.order.printer.status_text?vm.order.printer.status_code:''}}
                      {{vm.order.printer.error_text?vm.order.printer.error_code:''}}
                    </span><br>
                  </span>
                </div>
            </a>
            <a data-toggle="collapse" data-target="#cost" class="list-group-item">
                <span class="pull-right ">{{vm.order.costs.final_cost | currency : '£'}}</span> Cost
                <div id="cost" class="collapse">
                        <br>Card's Cost: <span class="pull-right ">{{vm.order.costs.card_items| currency : '£'}}</span><br>
                        Discount: <span class="pull-right ">- {{vm.order.costs.discount_amount| currency : '£'}}</span><br>
                        <span ng-if="vm.order.costs.discount_campaign_name" class="text-xs text-muted">
                          &nbsp;{{vm.order.costs.discount_campaign_name}} <span ng-if="vm.order.costs.discount_code">({{vm.order.costs.discount_code}})</span><br>
                        </span>
                        <span ng-if="vm.order.costs.credits_used > 0" class="text-xs text-muted">
                          &nbsp;Credit used : {{vm.order.costs.credits_used}}<br>
                        </span>
                        Delivery: <span class="pull-right ">+ {{vm.order.costs.delivery_cost.amount| currency : '£'}}</span><br><br>
                        Final Cost: <span class="pull-right ">{{vm.order.costs.final_cost| currency : '£'}}</span><br>
                        Paid with: 
                        <span class="pull-right ">
                          <i ng-if="vm.order.payment_method_type==='PAYPAL'" class="fa text-primary i-20 fa-cc-paypal"></i>
                          <i ng-if="vm.order.payment_method_type!=='PAYPAL'" class="fa text-primary i-20 fa-cc-stripe"></i>
                        </span>
                </div>
            </a>
              <a data-toggle="collapse" data-target="#platform" class="list-group-item">
                <span class="pull-right ">{{vm.order.order_report.order_interaction.platform.type}}</span> Platform
                <div id="platform" class="collapse">
                        <br>OS <span class="pull-right ">{{vm.order.order_report.order_interaction.platform.os}}</span><br>
                        OS version <span class="pull-right ">{{vm.order.order_report.order_interaction.platform.os_version}}</span><br><br>
                        Browser <span class="pull-right ">{{vm.order.order_report.order_interaction.platform.browser}}</span><br>
                        Browser version <span class="pull-right ">{{vm.order.order_report.order_interaction.platform.browser_version}}</span><br><br>
                        Screen size <span class="pull-right ">{{vm.order.order_report.order_interaction.platform.screen_size.height}}x{{vm.order.order_report.order_interaction.platform.screen_size.width}}<br>{{vm.device(vm.order.order_report.order_interaction.platform.screen_size.width)}}</span><br><br>
                </div>
            </a>
            <a class="list-group-item" data-toggle="collapse" data-target="#multiOrders">
                <div ><span class="pull-right">{{vm.multi.orders.length}}</span> Related Orders</div>
            </a>
            <div id="multiOrders" class="collapse">
              <div class="list-group-item">
                  <span class="text-u-l">This Order</span> : <span class="pull-right ">{{vm.order.human_readable_id}}</span>
              </div>
              <a class="list-group-item" ng-repeat="multi in vm.multi.orders| filter:{id:'!'+vm.order.id}" ui-sref="users.order({orderId: multi.id})">
                Order {{$index+2}}: <span class="pull-right" ng-class="vm.changeColor(multi.status,'text')">{{multi.status}}</span>
              </a>
            </div>
            <a class="list-group-item" data-toggle="collapse" data-target="#orderEmails">
                <div ><span class="pull-right">{{vm.emails.length}}</span>Emails</div>
            </a>
            <div id="orderEmails" class="collapse">
              <div class="list-group-item" ng-repeat="email in vm.emails">
                  {{vm.toTitleCase(email.email_type)}} 
                <button class="btn btn-stroke btn-primary pull-right" ng-click="vm.resendEmail(email)">Resend</button>
                <div>{{vm.toTitleCase(email.status)}} <span ng-if="email.status=='SENT'">on {{email.last_updated| date : "d MMM yy h:mm:ss a"}}</span></div>
              </div>
            </div>
          </div>
          <div class="p">
           <span class="pull-right ">{{vm.order.printer.order_id}}</span> Printer ID
          </div>
        </div>
      </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="panel panel-card">
                <div class="card-heading">
                    <h2>Status History</h2>
                </div>
                <div class="p">
                    <div class="streamline b-l b-accent m-b m-l">
                        <div class="sl-item sl-item-md" ng-class="vm.changeColor(status.status,'b')" ng-repeat="status in vm.order.status_changes">
                            <div class="sl-icon">
                                <i ng-class="vm.changeIcon(status.status)"></i>
                            </div>
                            <div class="sl-content">
                                <div class="text-muted-dk">{{status.created | date : 'd MMM yy h:mm:ss a'}}</div>
                                <p><a href class="text-info">{{status.status=="SENT"?"PLACED INTO POSTBAG":status.status}} <span ng-if="vm.dispatchDate(status.status,status.created)"><br>({{status.status}}: {{vm.dispatchDate(status.status,status.created)| date : 'd MMM yy'}})</span></a></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>
  <div class="col-sm-8">
    <div class="row">
      <div class="col-sm-12">
        <div class="panel panel-card">
          <md-button class="md-raised md-primary btn-fw m" ng-click="vm.reprintOrder()">Reprint</md-button>
          <md-button class="md-raised md-primary btn-fw m" ng-click="vm.sentToPrinter()">Send to Printer</md-button>
          <md-button class="md-raised md-primary btn-fw m" ng-click="vm.refundDialog()" ng-disabled="vm.order.refunded">Refund</md-button>
          <md-button class="md-raised md-primary btn-fw m" ng-click="vm.delivered(false)" ng-disabled="vm.order.status!=='SENT'">Mark as undelivered</md-button>
          <md-button ng-if="false" class="md-raised md-primary btn-fw m" ng-click="vm.delivered(true)" ng-disabled="vm.order.status!=='SENT'">Mark as delivered</md-button>
          <md-button class="md-raised md-primary btn-fw m" ng-click="vm.stopOrder()" ng-disabled="vm.order.status==='STOPPED'">Stop Order</md-button>
          <md-button class="md-raised md-primary btn-fw m" ng-click="vm.getProcoInfo()" >Printer Info</md-button>
          <md-button class="md-raised md-primary btn-fw m" ng-click="vm.sendEmail()">Email</md-button>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <form ng-submit="vm.setDelivery()" name="Address">
          <div class="panel panel-card">
            <div class="card-heading">
              <h2>Delivery</h2>
            </div>
            <div class="card-tools">
                <ul class="list-inline" >
                    <li class="dropdown">
                        <a md-ink-ripple data-toggle="dropdown" ng-click="vm.editAddress()" class="md-btn md-flat md-btn-circle">
                            <i class="mdi-image-edit text-md"></i>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="panel-body">
              <div class="row">
                <div class="col-sm-6">
                  <div class="row">
                    <div class="col-xs-2">
                      <i class="icon mdi-action-home i-16"></i>
                    </div>
                    <div ng-show="vm.editorAddress">
                      <div class="col-xs-10">
                        <div class="row">
                          <md-input-container class="md-block">
                            <input name="recipient" mdInput placeholder="Recipient" ng-model="vm.order.delivery_address.recipient" required>
                            <div ng-messages="Address.recipient.$error" role="alert">
                              <div ng-message="required"></div>
                            </div>
                          </md-input-container>
                        </div>
                        <div class="row">
                          <md-input-container class="md-block">
                            <input name="address1" mdInput placeholder="1st Line" ng-model="vm.order.delivery_address.address1" required>
                            <div ng-messages="Address.address1.$error" role="alert">
                              <div ng-message="required"></div>
                            </div>
                          </md-input-container>
                        </div>
                        <div class="row">
                          <md-input-container class="md-block">
                            <input mdInput placeholder="2nd Line" ng-model="vm.order.delivery_address.address2">
                          </md-input-container>
                        </div>
                        <div class="row">
                          <md-input-container class="md-block">
                            <input mdInput placeholder="3rd Line" ng-model="vm.order.delivery_address.address3">
                          </md-input-container>
                        </div>
                        <div class="row">
                          <md-input-container class="md-block">
                            <input name="city" mdInput placeholder="City" ng-model="vm.order.delivery_address.city" required>
                            <div ng-messages="Address.city.$error" role="alert">
                              <div ng-message="required"></div>
                            </div>
                          </md-input-container>
                        </div>
                        <div class="row" ng-if="vm.order.delivery_address.country=='United States'||vm.order.delivery_address.country=='Australia'||vm.order.delivery_address.state">
                          <md-input-container class="md-block">
                            <input name="state" mdInput placeholder="State" ng-model="vm.order.delivery_address.state" required>
                            <div ng-messages="Address.state.$error" role="alert">
                              <div ng-message="required"></div>
                            </div>
                          </md-input-container>
                        </div>
                        <div class="row">
                          <md-input-container class="md-block">
                            <input mdInput name="postcode" placeholder="Postcode" ng-model="vm.order.delivery_address.postcode" required>
                            <div ng-messages="Address.postcode.$error" role="alert">
                              <div ng-message="required"></div>
                            </div>
                          </md-input-container>
                        </div>
                      </div>
                    </div>
                    <div class="col-xs-10" ng-if="vm.order.delivery_address" ng-hide="vm.editorAddress">
                      <span ng-if="vm.order.delivery_address.recipient">{{vm.order.delivery_address.recipient}}<br></span>
                      <span ng-if="vm.order.delivery_address.address1">{{vm.order.delivery_address.address1}}<br></span>
                      <span ng-if="vm.order.delivery_address.address2">{{vm.order.delivery_address.address2}}<br></span>
                      <span ng-if="vm.order.delivery_address.address3">{{vm.order.delivery_address.address3}}<br></span>
                      <span ng-if="vm.order.delivery_address.city">{{vm.order.delivery_address.city}}<br></span>
                      <span ng-if="vm.order.delivery_address.state">{{vm.order.delivery_address.state}}<br></span>
                      <span ng-if="vm.order.delivery_address.postcode">{{vm.order.delivery_address.postcode}}<br></span>
                      <span ng-if="vm.order.delivery_address.country">{{vm.order.delivery_address.country}}<br></span>
                    </div>
                    <div class="col-sm-10" ng-if="!vm.order.delivery_address">
                      No Delivery address
                    </div>
                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="row">
                    <div class="col-xs-2">
                      <i class="icon mdi-action-face-unlock i-16"></i>
                    </div>
                    <div class="col-xs-10">
                        <p>Recipient Type:<br>
                          <span ng-hide="vm.editorAddress">{{vm.order.recipient_type}}</span>
                        </p>
                      <div ng-show="vm.editorAddress">
                        <div class="form-horizontal form-validation">
                          <div class="form-group">
                            <div class="col-sm-8">
                              <div class="radio">
                                <label>
                                  <input type="radio" name="optionsRadios" id="optionsRadios1" ng-model="vm.order.recipient_type" value="home_fill" ng-checked="vm.order.recipient_type==='home_fill'">
                                  home fill
                                </label>
                              </div>
                              <div class="radio">
                                <label>
                                  <input type="radio" name="optionsRadios" id="optionsRadios2" ng-model="vm.order.recipient_type" value="direct_send" ng-checked="vm.order.recipient_type==='direct_send'">
                                  direct send
                                </label>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-xs-2">
                        <i class="icon mdi-notification-event-note i-16"></i>
                    </div>
                    <div class="col-xs-10">
                      Requested arrival date: <br>
                      <div ng-hide="vm.editorAddress" ng-class="vm.arrivalDate(vm.order.order_delivery.requested_arrival_date)">
                        <div ng-if="vm.order.order_delivery.dispatch_type==='IMMEDIATE'">{{vm.order.order_delivery.dispatch_type}}</div>
                        <p ng-if="vm.order.order_delivery.requested_arrival_date">{{vm.order.order_delivery.requested_arrival_date| date: "d/M/yy"}}</p>
                          Estimated Arrival Date: <br>
                          {{vm.order.order_delivery.estimated_earliest_arrival_date| date: "d/M/yy"}}
                          <span ng-if="vm.order.order_delivery.estimated_earliest_arrival_date!=vm.order.order_delivery.estimated_latest_arrival_date">
                            -{{vm.order.order_delivery.estimated_latest_arrival_date| date: "d/M/yy"}}
                          </span>
                      </div>
                      <div ng-show="vm.editorAddress">
                        <div class="form-horizontal form-validation">
                          <div class="form-group">
                            <div class="col-sm-12">
                              <md-datepicker ng-model="vm.date" md-hide-icons="calendar" md-date-filter="vm.dateFilter"></md-datepicker>
                            </div>
                          </div>
                        </div>
                        Best arrival date:<br>{{vm.bestArrivaldate| date: "d/M/yy"}}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <footer class="panel-footer text-right" ng-show="vm.editorAddress">
              <button class="btn btn-primary" type="submit" ng-disabled="Address.$error.required">Submit</button>
              <a class="btn btn-default" ng-click="vm.editAddress()">Cancel</a>
            </footer>
          </div>
        </form>
    </div>
  </div>
  <div class="row" ng-if="vm.order.order_options && vm.order.order_options.length >0">
    <div class="col-sm-12">
      <div class="panel panel-card">
        <div class="card-heading">
          <h2>Optional items</h2>
        </div>
        <div class="panel-body">
          <p ng-repeat="option in vm.order.order_options">
              <a ng-click="vm.editItemOption(option)" class="md-flat md-btn-circle">
                  <i class="mdi-image-edit text-md"></i>
                </a>{{option.name+" : "+option.printer_name}}
          </p>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12">
      <div class="panel panel-card">
        <div class="card-heading">
          <div class="h4">Cards
            <span class="pull-right">
              <md-button class="md-raised md-primary" ng-click="vm.getSample()" ng-disabled="vm.loadingSample">{{vm.open?'Close':'Open'}} Cards</md-button>
            </span>
          </div>
        </div>
        <div class="panel-body">
          <div ng-repeat="card in vm.order.cards" class="row p">
              <a ui-sref="cards.card({cardId: card.card_id})" class="col-xs-3 inline" ng-if="!vm.open">
                <img ng-src="{{card.image.medium}}" class="img-responsive">
              </a>
              <a href="{{vm.getInerBack(card.id)}}" class="col-xs-3 inline" ng-if="vm.open">
                <img ng-src="{{vm.getInerBack(card.id)}}" class="img-responsive">
              </a>
              <div class='col-xs-9'>
              <span ng-if="card.visibility!=='PRIVATE'||card.moderation&&card.moderation.status!=='AWAITING_REVIEW'" ng-class="{'text-success': card.moderation.status==='MODERATED','text-danger':card.moderation.status!=='MODERATED'}">{{card.moderation.status}}<br></span>
              <span ng-if="card.visibility==='PRIVATE'&&card.moderation&&card.moderation&&card.moderation.status==='AWAITING_REVIEW'" ng-style="{'margin-left': '-8px'}">
                <md-button  class="md-raised md-primary" ng-click="vm.approveCard(card)" ng-disabled="vm.loadingSample">Approve (PRIVATE)</md-button>
                <br>
              </span>
              ID: {{card.card_id}}<br>
              Printer ID: {{card.printer.proco_id}}<br>
              Quantity: {{card.quantity}}<br>
              Format: {{card.format}}
              <span ng-if="card.item_options[0]">, {{card.item_options[0].name}}
                  <a ng-click="vm.editCardsItem(card)" class="md-flat md-btn-circle">
                    <i class="mdi-image-edit text-md"></i>
                  </a>
                </span><br>
              Printer Status: <span ng-class="{'text-success':card.printer.status_text,'text-danger':card.printer.error_text,'text-warning':!card.printer}">
                {{card.printer.status_text?card.printer.status_text:''}}
                {{card.printer.error_text?card.printer.error_text:''}}
                {{!card.printer?'waiting':''}}
              </span><br>
              <span ng-if="card.printer">Printer Code: <span ng-class="{'text-success':card.printer.status_text,'text-danger':card.printer.error_text}">
                  {{card.printer.status_text?card.printer.status_code:''}}
                  {{card.printer.error_text?card.printer.error_code:''}}
                </span><br>
              </span>
              Customisation: {{card.inner_back.type}}<br>
              <p>
                <a href="{{card.product_proof.original}}" ng-if="card.product_proof.original"><i class="icon mdi-file-file-download i-20"></i> Download PDF</a></p>
               <div class="form-group" ng-if="card.inner_back.text_customisation_request">
                <label ng-click="vm.messageEditor(card)"><i class="fa fa-pencil i-20"></i><ins>Message</ins></label>
                <div ng-hide="card.selected">
                  <pre>{{card.inner_back.text_customisation_request.text}}</pre>
                </div>
                <div ng-if="card.selected">  
                  <textarea class="form-control" rows="6" ng-model="card.inner_back.text_customisation_request.text" placeholder="Type your message"></textarea>
                  <button class="btn btn-primary" ng-click="vm.changeMessage(card,card.inner_back.text_customisation_request)">Submit</button>
                  <button class="btn btn-default" ng-click="vm.messageEditor(card)">Cancel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
      <!--right hand side panel-->
  </div>
</div>