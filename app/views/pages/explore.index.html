<div class="row">
  <div class="col-sm-12 h3 text-center">
    <div class="panel panel-card red">
      <div class="panel-heading">Beta Test Page, PLEASE do not change anything if you don't know how it works!</div>
    </div>
  </div>
</div>
<div class="row" ng-if="!vm.single">
  <div class="col-sm-12">
    <md-button class="md-raised md-primary pull-right" ui-sref="explore.index({id: 'new'})">New Curate Index</md-button>
  </div>
</div>
<div class="row" ng-if="vm.ready&&!vm.single">
  <div class="col-xs-6 col-sm-5 col-md-4 col-lg-2" ng-repeat="index in vm.indexList" ui-sref="explore.index({id: index.id})">
    <div class="card">
      <div class="list-group-item">
        Categories <span class="pull-right">{{index.criteria.categories.length}} </span>
        <div>
          <span class="badge bg-primary" ng-repeat="cat in index.criteria.categories" ng-if="$index<2">{{$index<1?vm.categoryName(cat):'..'}} </span>
          <br>
        </div> 
      </div>
      <div class="list-group-item">
        Tags <span class="pull-right">{{index.criteria.tags.length}}</span>
        <div>
          <span class="badge bg-primary" ng-repeat="tag in index.criteria.tags track by $index" ng-if="$index<2">{{$index<1?tag:'..'}} </span>
          <br>
        </div>
      </div>
      <div class="list-group-item">
        Keywords <span class="pull-right">{{index.criteria.keywords.length}}</span>
        <div>
          <span class="badge bg-primary" ng-repeat="key in index.criteria.keywords track by $index" ng-if="$index<2">{{$index<1?key:'..'}} </span>
          <br>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row" ng-if="!vm.ready">
  <div class="col-sm-12">
    <div class="panel panel-card">
      <div class="panel-body text-center">
        <p>Loading</p>
        <md-progress-linear md-mode="indeterminate" class="m-b"></md-progress-linear>
      </div>
    </div>
  </div>
</div>

<!-- single index -->
<div class="row" ng-if="vm.single&&vm.index">
  <div class="h4">
    <a ui-sref="explore.index({id:null})">
      <i class="glyphicon glyphicon-chevron-left pull-left"></i> Back
    </a>
    <span class="pull-right" ng-if="vm.index.hash">Hash: {{vm.index.hash}}</span>
  </div>
  <br>
  <div class="row">
    <div class="col-sm-12">
      <div class="panel panel-card">
        <div class="panel-body">
          <span class="pull-left">
            <ul class="nav nav-pills m-b">
              <li class="nav-item active" ng-if="vm.index.id">
                <a href data-toggle="pill" data-target="#card-tab">Cards ({{vm.cardList.length}})</a>
              </li>
              <li class="nav-item {{!vm.index.id?'active':''}}">
                <a href data-toggle="pill" data-target="#tags-tab">Tags ({{vm.index.criteria.tags.length}})</a>
              </li>
              <li class="nav-item">
                <a href data-toggle="pill" data-target="#category-tab">Categories ({{vm.index.criteria.categories.length}})</a>
              </li>
              <li class="nav-item">
                <a href data-toggle="pill" data-target="#keyword-tab">Keywords ({{vm.index.criteria.keywords.length}})</a>
              </li>
            </ul>
          </span>
          <span class="pull-right">
            <md-button class="md-raised md-primary btn-fw m-b-sm" ng-click="vm.saveIndex(vm.index)">Save</md-button>
            <md-button class="md-raised md-primary btn-fw m-b-sm" ng-click="vm.deleteDialog(vm.index)">Delete</md-button>
          </span>
        </div>
      </div>
    </div>
  </div>
  <div class="tab-content">
    <div class="tab-pane active" id="card-tab" role="tabpanel" ng-if="vm.index.id">
      <div class="row">
        <div class="col-sm-8">
          <ul class="nav nav-pills">
            <li ng-repeat="card in vm.cardList| orderBy:'rank'" ng-click=""><!-- ng-mousedown="vm.selectedCard($index,true,vm.cardList)" ng-mouseover="vm.selectedCard($index,'over',vm.cardList)"> -->
              <div class="card">
                <div class="card-heading text-center">
                  <a>
                    <img class="card {{card.card.orientation=='PORTRAIT'?'w-sm':'w-sm'}}" ng-src="{{card.card.image.large}}">
                    <span style="position: absolute;top:0;bottom:0;left:0;right:0;"></span>
                  </a>
                  <span class="pull-right" style="position: absolute;">
                    <ul class="list-inline">
                      <li class="dropdown">
                        <a data-toggle="dropdown" class="md-btn md-btn-circle">
                          <i class="mdi-navigation-more-vert text-md"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-scale pull-right pull-up top text-color">
                          <li>
                            <a ng-click="vm.deleteDialog(card,'card')">Delete</a>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </span>
                </div>
                <div class="list-group-item">
                  <md-input-container style="margin: 0;height: 30px;width: 50%;">
                    <input mdInput type="number" placeholder="Rank" ng-model="rank" ng-init="rank=card.rank">
                  </md-input-container>
                  <span ng-if="rank!=card.rank" style="position: absolute;right: 30px;">
                    <a ng-click="vm.saveRank(card,rank)" class="glyphicon rounded green">
                      <i class="icon mdi-navigation-check i-20"></i>
                    </a>
                  </span>
                </div>
              </div>
            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <div class="panel panel-card">
            <div class="panel-body">
              <form ng-submit="vm.cardSearch(card)">
                <div class="form-group">
                  <div class="input-group">
                    <a type="submit" class="input-group-addon" ng-click="vm.cardSearch(card)">Find Cards</a>
                    <input type="text" name="search" class="form-control" ng-model="card" placeholder="card id">
                  </div>
                </div>
              </form>
              <div class="text-center">
                <md-button class="md-raised md-primary btn-fw m-b-sm" ng-if="vm.newCardList&&vm.newCardList.length" ng-click="vm.addCards()">Add card{{vm.newCardList.length>1?'s':''}}</md-button>
              </div>
              <ul class="nav nav-pills">
                  <li ng-repeat="card in vm.newCardList" ng-click="vm.addCards($index)">
                    <img class="card {{card.orientation=='PORTRAIT'?'w-xs':'w-xs'}}" ng-src="{{card.image.large}}">
                  </li>
                </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="tab-pane {{!vm.index.id?'active':''}}" id="tags-tab" role="tabpanel">
      <div class="panel panel-card">
        <div class="panel-heading">
          <!-- <span class="pull-right">
            <md-button class="md-raised md-primary btn-fw m-b-sm" ng-click="vm.saveTags()">SAVE</md-button>
          </span> -->
          <h3>Selected Tags</h3>
        </div>
        <div class="panel-body">
          <span ng-repeat="tags in vm.selectedTags">
            <a class="btn" ng-click="vm.removeTag(tags)" ng-class="vm.selected(tags,'tag')">{{tags}}</a>
            <span>
        </div>
      </div>
      <div class="panel panel-card">
        <div class="panel-body">
          <div class="p">
            <h3>Add Tags</h3>
          </div>
          <form class="input-group" ng-submit="vm.addTag(vm.input)">
            <a type="submit" class="input-group-addon" ng-click="vm.addTag(vm.input)">Add</a>
            <input type="text" name="Tag" class="form-control" ng-model="vm.input" placeholder="New Tag">
          </form>
          <div class="p" ng-repeat="tags in vm.tagList">
            <h4>{{tags.title}}
              <br>
              <br>
            </h4>
            <span ng-repeat="filter in tags.tags">
              <a class="btn" ng-click="vm.addTag(filter)" ng-class="vm.selected(filter,'tag')">{{filter}}</a>
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="tab-pane" id="category-tab" role="tabpanel">
      <div class="panel panel-card">
        <div class="panel-heading">
          <h3>Selected Categories</h3>
        </div>
        <div class="panel-body">
          <span ng-repeat="category in vm.selectedCategories">
            <a class="btn" ng-class="vm.selected(category,'category')" ng-click="vm.removeCategory(category)">{{vm.categoryName(category)}}</a>
            <span>
        </div>
      </div>
      <div class="panel panel-card">
        <div class="panel-heading">
          <h3>Categories</h3>
        </div>
        <div class="panel-body">
          <span>
            <a class="btn btn-default" ng-click="vm.addCategory(category.id)" ng-repeat="category in vm.categoryList"
              ng-class="vm.selected(category.title,'category')">{{category.title}}</a>
          </span>
        </div>
      </div>
    </div>
    <div class="tab-pane" id="keyword-tab" role="tabpanel">
      <div class="panel panel-card">
        <div class="panel-heading">
          <h3>Selected Keywords</h3>
        </div>
        <div class="panel-body">
          <span ng-repeat="keyword in vm.selectedKeywords">
            <a class="btn" ng-class="vm.selected(keyword,'keyword')" ng-click="vm.removeKeyword(keyword)">{{keyword}}</a>
            <span>
        </div>
      </div>
      <div class="panel panel-card">
        <div class="panel-heading">
          <h3>Keywords</h3>
        </div>
        <div class="panel-body">
          <form ng-submit="vm.addKeyword(keyword)">
            <div class="form-group">
              <div class="input-group">
                <a type="submit" class="input-group-addon" ng-click="vm.addKeyword(keyword)">Add Keyword</a>
                <input type="text" name="search" class="form-control" ng-model="keyword" placeholder="new keyword">
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>